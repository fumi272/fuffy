<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>GAS API 呼び出しテスト</title>
  </head>
  <body>
    <h1>Google Apps Script API 呼び出し</h1>
    <button id="callBtn">API 呼び出し</button>
    <pre id="result"></pre>
    
    <div id="login-area">
      <h2>ログイン</h2>
    	<input id="email" type="email" placeholder="メールアドレス"><br>
    	<input id="password" type="password" placeholder="パスワード"><br>
    	<button id="login-button">ログイン</button>
    	<p id="login-error" style="color: red;"></p>
    </div>
    
    <div id="chat-area" style="display: none;">
    	<!-- ログアウトボタンを追加 -->
    	<div style="text-align: right; margin: 10px;">
    	  <button onclick="logout()">ログアウト</button>
    	</div>
    	<!-- 既存のチャットUI -->
    	<div id="chat">
    		<div class="message bot">
    			<div class="bubble">こんにちは。今日はどうしますか？<br>
      		  (1)家の住所登録<br>
      			(2)職場の住所登録<br>
      			(3)<br>
    			</div>
    		</div>
    	</div>
    	<div id="input-area">
    		<textarea id="input" placeholder="メッセージを入力..." rows="1"></textarea>
    		<button id="send">送信</button>
    	</div>
    </div>
    
    <script>
      const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwc3r6DbRmZIkBpwfWGLVHRpDL_nDZ2lLUiV2cuVTVxjv81LoAxFSig4IgPLnENZQZrAQ/exec";
  
      document.getElementById("callBtn").addEventListener("click", () => {
        fetch(GAS_WEB_APP_URL)
          .then(response => {
            if (!response.ok) throw new Error("HTTP error " + response.status);
            return response.json();
          })
          .then(data => {
            document.getElementById("result").textContent = JSON.stringify(data, null, 2);
          })
          .catch(err => {
            document.getElementById("result").textContent = "エラー: " + err.message;
          });
      });

    	loginBtn.onclick = async () => {
    	  const email = document.getElementById('email').value.trim();
    		const password = document.getElementById('password').value.trim();
        
    		if (!email || !password) {
    			errorMsg.textContent = 'メールアドレスとパスワードを入力してください。';
    			return;
    		}
        
    		try {
    			const res = await fetch('https://script.google.com/macros/s/AKfycbydykXHpRJR1CaXHq0bxhz3rHY_6eB-QuY3rC-DqkCl0Us8uk0wuOQBQZ-K76DB1r4_Tw/exec', {
    				method: 'POST',
    				headers: { 'Content-Type': 'application/json' },
    				body: JSON.stringify({ "email": email, "password": password })
    			});
          
    			if (!res.ok) throw new Error('認証に失敗しました');
          
    			const data = await res.json();
          
    			// 例：アクセストークンを保存
    			localStorage.setItem('authToken', data.token);
    
    			// UI切り替え
    			document.getElementById('login-area').style.display = 'none';
    			document.getElementById('chat-area').style.display = 'block';
    		} catch (err) {
    			errorMsg.textContent = err.message;
    	  }
    	};


      
    </script>
  </body>
</html>
